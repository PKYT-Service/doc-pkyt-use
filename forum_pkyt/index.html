<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service Info</title>
    <style>
        .hidden { display: none; }
        .block { display: block; }
        .py-4 { padding: 1rem 0; }
        .text-center { text-align: center; }
        .hover\:bg-gray-600:hover { background-color: #4a5568; }
    </style>
</head>
<body>
    <div id="service-info">
        <h1>Service Information</h1>
        <ul id="service-links"></ul>
    </div>

    <script>
        // Fonction pour charger une page
        function loadPage(url) {
            window.location.href = url;
        }

        // Fonction pour récupérer les données d'un fichier JSON
        async function fetchJson(url) {
            try {
                const response = await fetch(url);
                return await response.json();
            } catch (error) {
                console.error("Erreur lors de la récupération du fichier JSON : ", error);
                return null;
            }
        }

        // Fonction principale
        async function loadAccountData() {
            const account = localStorage.getItem('account');

            if (account) {
                // Récupération des données du compte
                const accountUrl = `https://pkyt-database-up.vercel.app/account/v3/${account}.json`;
                const accountData = await fetchJson(accountUrl);

                if (accountData && accountData.service && accountData.service.nomDuService) {
                    const nomDuService = accountData.service.nomDuService;
                    console.log("Nom du service : ", nomDuService);

                    // Récupérer le fichier forum.json
                    const forumData = await fetchJson('https://pkyt-database-up.vercel.app/forum.json');

                    if (forumData) {
                        const serviceLinksContainer = document.getElementById('service-links');
                        let serviceFound = false;

                        // Parcourir les services du forum
                        for (let service in forumData) {
                            if (service === nomDuService) {
                                serviceFound = true;

                                // Récupérer les sections du service correspondant
                                const sectionUrl = forumData[service];
                                const sectionData = await fetchJson(sectionUrl);

                                if (sectionData) {
                                    // Afficher la section si présente
                                    if (sectionData.section) {
                                        const sectionHtml = `
                                            <hr>
                                            <center>
                                                <b>${sectionData.section}</b>
                                            </center>
                                            <hr>
                                        `;
                                        serviceLinksContainer.insertAdjacentHTML('beforeend', sectionHtml);
                                    }

                                    // Afficher les liens si présents
                                    if (sectionData.link) {
                                        const linkHtml = `
                                            <li>
                                                <a onclick="loadPage('${sectionData.link}')" class="block py-4 text-center hover:bg-gray-600">
                                                    ${sectionData.linkName || 'Lien'}
                                                </a>
                                            </li>
                                        `;
                                        serviceLinksContainer.insertAdjacentHTML('beforeend', linkHtml);
                                    }
                                }
                            }
                        }

                        if (!serviceFound) {
                            console.log("Aucun service correspondant trouvé.");
                        }
                    }
                }
            } else {
                console.warn("Aucun compte trouvé dans le localStorage.");
            }
        }

        // Charger les données du compte au chargement de la page
        window.addEventListener('load', loadAccountData);
    </script>
</body>
</html>
