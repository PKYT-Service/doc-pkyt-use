<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connexion</title>
    <script>
        async function loadConfig() {
            try {
                // Charger la configuration depuis le fichier config.json
                const configResponse = await fetch('config.json');
                const config = await configResponse.json();
                
                // Extraire les détails du web
                const webDetails = config['web-details'];
                
                // Mettre à jour le titre et les métadonnées
                document.title = webDetails[0]; // title
                const metaTitle = document.createElement('meta');
                metaTitle.name = "title";
                metaTitle.content = webDetails[1]; // title_meta
                document.head.appendChild(metaTitle);

                const metaDescription = document.createElement('meta');
                metaDescription.name = "description";
                metaDescription.content = webDetails[2]; // description_meta
                document.head.appendChild(metaDescription);

                const linkIcon = document.createElement('link');
                linkIcon.rel = "icon";
                linkIcon.href = webDetails[3]; // ico_web
                document.head.appendChild(linkIcon);

                const metaIcon = document.createElement('meta');
                metaIcon.name = "icon";
                metaIcon.content = webDetails[4]; // ico_meta
                document.head.appendChild(metaIcon);

                const metaLink = document.createElement('meta');
                metaLink.name = "link";
                metaLink.content = webDetails[5]; // link_meta
                document.head.appendChild(metaLink);

            } catch (error) {
                console.error('Erreur lors du chargement de la configuration:', error);
            }
        }

        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            try {
                // Charger la configuration depuis le fichier config.json
                const configResponse = await fetch('config.json');
                const config = await configResponse.json();
                const service = config.config[2]; // service est "pkyt"
                const acceptUrl = config.redirection[0]; // connexion_accepter
                const refuseUrl = config.redirection[1]; // connecion_refuser
                const notFoundUrl = config.redirection[2]; // account_introuvable

                // Construire l'URL de vérification
                const url = `https://pkyt-database-up.vercel.app/account/v3/${email}-${password}*${service}.json`;

                const response = await fetch(url);

                if (response.ok) {
                    // Stocker les informations de connexion dans le localStorage
                    localStorage.setItem('user', `${email}-${password}*${service}`);
                    // Rediriger vers la page de connexion valide
                    window.location.href = acceptUrl;
                } else {
                    // Rediriger vers la page d'erreur
                    window.location.href = refuseUrl;
                }
            } catch (error) {
                // Rediriger vers la page d'erreur en cas de problème de requête
                window.location.href = notFoundUrl;
            }
        }

        // Charger la configuration au chargement de la page
        window.onload = loadConfig;
    </script>
</head>
<body>
    <h1>Connexion</h1>
    <form id="loginForm" onsubmit="handleLogin(event)">
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required><br><br>
        <label for="password">Mot de passe:</label>
        <input type="password" id="password" name="password" required><br><br>
        <button type="submit">Me connecter</button>
    </form>
</body>
</html>
